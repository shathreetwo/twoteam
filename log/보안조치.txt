Apache â†’ Spring Boot ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •

Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì•ë‹¨ì— Apache ì›¹ ì„œë²„ë¥¼ êµ¬ì„±

ì „ì²´ ëª©í‘œ ì•„í‚¤í…ì²˜
ì¸í„°ë„· â†’ Apache (80, 443 í¬íŠ¸) â†’ Spring Boot (8080 í¬íŠ¸) â†’ MySQL

1. Apache ì„¤ì¹˜ (Ubuntu ê¸°ì¤€)
sudo apt update
sudo apt install apache2

sudo systemctl status apache2 (ë™ì‘ì—¬ë¶€í™•ì¸)

[Apache â†’ Spring Boot ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
Apacheê°€ ì™¸ë¶€ ìš”ì²­ì„ ë°›ì•„ì„œ ë‚´ë¶€ì˜ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜(8080 í¬íŠ¸)ë¡œ ì „ë‹¬í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.]
2. proxy ëª¨ë“ˆ í™œì„±í™”

sudo a2enmod proxy
sudo a2enmod proxy_http

ì‚¬ì´íŠ¸ ì„¤ì • íŒŒì¼ ì—´ê¸°:
sudo nano /etc/apache2/sites-available/000-default.conf

<VirtualHost *:80> ì•„ë˜ì— ë‹¤ìŒì„ ì¶”ê°€:
ProxyPass / http://localhost:8080/
ProxyPassReverse / http://localhost:8080/

Apache ì¬ì‹œì‘:
sudo systemctl restart apache2

ìŠ¤í”„ë§ë¶€íŠ¸ ì‹¤í–‰
nohup java -jar demo-0.0.1-SNAPSHOT.jar --spring.config.location=file:/home/ubuntu/application-aws.properties >/dev/null 2>&1 &

ë¸Œë¼ìš°ì € ì ‘ì†
http://3.20.199.113:8080/
ì´ìƒì—†ìŒ. 

------

AWS WAFëŠ” Application Load Balancer(ALB), API Gateway, ë˜ëŠ” CloudFrontì—ì„œë§Œ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— EC2ì˜ Apacheì— ì§ì ‘ ì ìš©í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹  ì•„ë˜ì²˜ëŸ¼ ëŒ€ì²´í•˜ê±°ë‚˜ ì‹¤ìŠµí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:

1. ì›¹ ë°©í™”ë²½(WAF) ëª¨ì˜ ì„¤ì • ë° ì°¨ë‹¨ ê·œì¹™ ì‹¤í—˜
Apacheì— ModSecurityë¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ì›¹ ë°©í™”ë²½ ëª¨ë“ˆì„ ì„¤ì¹˜í•˜ê³  OWASP Core Rule Setì„ ì ìš©í•˜ë©´, WAFì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ë³´ì•ˆ í•„í„°ë¥¼ EC2ì—ì„œ ì‹¤í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì„¤ì¹˜ ë° ì ìš©
sudo apt install libapache2-mod-security2
sudo a2enmod security2

OWASP Core Rule Set(CRS) ì ìš©:
cd /etc/modsecurity
sudo mv modsecurity.conf-recommended modsecurity.conf
sudo nano modsecurity.conf
SecRuleEngineì„ DetectionOnly â†’ Onìœ¼ë¡œ ë³€ê²½

(DetectionOnly ëª¨ë“œ "ì°¨ë‹¨í•˜ì§€ ì•Šê³  ê¸°ë¡ë§Œ"
SecRuleEngine Onì€ ì°¨ë‹¨ ëª¨ë“œ)

CRS ë‹¤ìš´:
cd /etc/apache2/modsecurity.d/
sudo git clone https://github.com/coreruleset/coreruleset.git
sudo cp coreruleset/crs-setup.conf.example coreruleset/crs-setup.conf

/etc/apache2/modsecurity.d/include.conf íŒŒì¼ ìƒì„± ë° ë‹¤ìŒ ì¶”ê°€:
IncludeOptional modsecurity.d/coreruleset/crs-setup.conf
IncludeOptional modsecurity.d/coreruleset/rules/*.conf

Apache ì¬ì‹œì‘:
sudo systemctl restart apache2


-----

Apache ë³´ì•ˆ ì„¤ì • í•­ëª©


-----

ë°©í™”ë²½ ë° í¬íŠ¸ ìŠ¤ìºë‹ ëŒ€ì‘
ufw ì‚¬ìš©í•´ì„œ Apache(80, 443) ì™¸ í¬íŠ¸ ì°¨ë‹¨:

sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 22
sudo ufw enable

sudo ufw status(í™•ì¸)

ê²°ê³¼ : 
Status: active

To                         Action      From
--                         ------      ----
80                         ALLOW       Anywhere
443                        ALLOW       Anywhere
22                         ALLOW       Anywhere
80 (v6)                    ALLOW       Anywhere (v6)
443 (v6)                   ALLOW       Anywhere (v6)
22 (v6)                    ALLOW       Anywhere (v6)

ì•„ë‹ˆ í•œì°¸ í•´ë§¸ë„¤
8080ì•ˆì—´ì—ˆì–ì•„.


[í¬íŠ¸ ìŠ¤ìºë‹ íƒì§€ (ëŠ¥ë™ ëŒ€ì‘í•˜ê³  ì‹¶ë‹¤ë©´)
ufwëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í¬íŠ¸ë¥¼ ì°¨ë‹¨í•  ë¿, ìŠ¤ìºë‹ì„ íƒì§€í•˜ê±°ë‚˜ ê²½ê³ í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤.
ì¢€ ë” ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •ì„ ì›í•˜ë©´ ì•„ë˜ë¥¼ ê³ ë ¤í•˜ì„¸ìš”:

ğŸ”¹ [Fail2Ban] ì„¤ì¹˜ (SSH, Apache ê³µê²© ì‹œë„ ì°¨ë‹¨)
bash
ë³µì‚¬
í¸ì§‘
sudo apt install fail2ban
í¬íŠ¸ ìŠ¤ìºë„ˆ, SSH ë¬´ì°¨ë³„ ë¡œê·¸ì¸ ì‹œë„ ë“± ê°ì§€í•´ì„œ ìë™ ì°¨ë‹¨

ğŸ”¹ [ModSecurityì— í¬íŠ¸ ìŠ¤ìºë‹ ë£° ì¶”ê°€]
í¬íŠ¸ ìŠ¤ìºë‹ì€ HTTP ë ˆë²¨ì—ì„œëŠ” ì˜ ê°ì§€ë˜ì§€ ì•Šì§€ë§Œ, WAFë¡œë„ ì¼ë¶€ ëŒ€ì‘ ê°€ëŠ¥
(ì˜ˆ: ê°™ì€ IPê°€ 1ì´ˆ ì•ˆì— 30ê°œ ì´ìƒì˜ ê²½ë¡œ ì ‘ê·¼ ì‹œ ì°¨ë‹¨)
]

-----